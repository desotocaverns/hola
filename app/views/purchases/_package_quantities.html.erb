<h2>Tickets</h2>

<!-- TODO move the form into a partial, render it here, then you can also re-render it respond_to :js, and let the
     browser receive the HTML and update the form -->
<%= form_for @purchase, :remote => true, :url => collect_quantity_path, :method => collect_quantity_method, :html => {:id => "package_form"} do |f| %>
  <span id="package_quantity_errors"></span>

  <% @packages.each do |package| %>
    <% purchased_package = @purchase.purchased_packages.detect {|e| e.package_id == package.id } %>
    <%= f.fields_for(:purchased_packages, purchased_package || @purchase.purchased_packages.build) do |package_fields| %>
        <div class="form-row">
          <%= package.title %>
          <%= package_fields.text_field :quantity, class: "quantity_select", type: "number", size: 2, min: 0 %>
          <%= package_fields.hidden_field :package_id, value: package.id %>
        </div>
    <% end %>
  <% end %>

  <div>
    <%= f.hidden_field :js_calculated_price, id: "js_calculated_price" %>
    <%= f.hidden_field :collecting_quantity, value: true %>
    <%= f.hidden_field :redemption_id %>
    <%= f.submit "Continue" %>
  </div>
<% end %>
