$('#outer').append("<%= escape_javascript render(partial: 'collect_card', status: :success) %>");

$( document ).ready( function() {
  var handler = StripeCheckout.configure({
    key: 'pk_test_lgoJadzJlZSpLwrY1sJPinZK',
    token: function(token) {
      payment_form = $('#payment_form');
      payment_form.find('#stripe_token').val(token.id);
      payment_form.submit()
    }
  });

  handler.open({
    name: 'DeSoto Caverns',
    description: '1 Ticket',
    email: "<%= @purchase.email %>",
    amount: <%= @purchase.js_calculated_price.to_int * 1.04 %>,
    allowRememberMe: false
  });
  e.preventDefault();

  $(window).on('popstate', function() {
    handler.close();
  });
});
